{
  "components": {
    "securitySchemes": {
      "LambdaAuthorizer": {
        "in": "header",
        "name": "NHSD-Supplier-ID",
        "type": "apiKey",
        "x-amazon-apigateway-authorizer": {
          "authorizerCredentials": "${APIG_EXECUTION_ROLE_ARN}",
          "authorizerResultTtlInSeconds": 0,
          "authorizerUri": "arn:aws:apigateway:${AWS_REGION}:lambda:path/2015-03-31/functions/${AUTHORIZER_LAMBDA_ARN}/invocations",
          "identitySource": "method.request.header.NHSD-Supplier-ID",
          "type": "request"
        },
        "x-amazon-apigateway-authtype": "custom"
      }
    }
  },
  "info": {
    "description": "NHS Notify Supplier API",
    "title": "NHS Notify - Suppliers - Supplier API",
    "version": "v1"
  },
  "openapi": "3.0.1",
  "paths": {
    "/letters": {
      "get": {
        "description": "Returns 200 OK with paginated letter ids.",
        "responses": {
          "200": {
            "description": "OK"
          }
        },
        "security": [
          {
            "LambdaAuthorizer": []
          }
        ],
        "summary": "Get letters",
        "x-amazon-apigateway-integration": {
          "contentHandling": "CONVERT_TO_TEXT",
          "credentials": "${APIG_EXECUTION_ROLE_ARN}",
          "httpMethod": "POST",
          "passthroughBehavior": "WHEN_NO_TEMPLATES",
          "responses": {
            ".*": {
              "statusCode": "200"
            }
          },
          "timeoutInMillis": 29000,
          "type": "AWS_PROXY",
          "uri": "arn:aws:apigateway:${AWS_REGION}:lambda:path/2015-03-31/functions/${GET_LETTERS_LAMBDA_ARN}/invocations"
        }
      }
    },
    "/letters/{id}": {
      "parameters": [
        {
          "description": "Unique identifier of this resource",
          "in": "path",
          "name": "id",
          "required": true,
          "schema": {
            "type": "string"
          }
        }
      ],
      "patch": {
        "description": "Update the status of a letter by providing the new status in the request body.",
        "operationId": "patchLetters",
        "requestBody": {
          "content": {
            "application/vnd.api+json": {
              "examples": {
                "patch-letter-request": {
                  "value": {
                    "data": {
                      "attributes": {
                        "reasonCode": 100,
                        "reasonText": "failed validation",
                        "requestedProductionStatus": "ACTIVE",
                        "specificationId": "2WL5eYSWGzCHlGmzNxuqVusPxDg",
                        "status": "REJECTED"
                      },
                      "id": "2WL5eYSWGzCHlGmzNxuqVusPxDg",
                      "type": "Letter"
                    }
                  }
                }
              },
              "schema": {
                "properties": {
                  "data": {
                    "properties": {
                      "attributes": {
                        "properties": {
                          "reasonCode": {
                            "description": "Reason code for the given status",
                            "examples": [
                              100
                            ],
                            "type": "number"
                          },
                          "reasonText": {
                            "description": "Reason text for the given status",
                            "examples": [
                              "failed validation"
                            ],
                            "type": "string"
                          },
                          "requestedProductionStatus": {
                            "description": "The requested production status for this letter.\nMay only be set by NHS Notify.",
                            "enum": [
                              "ACTIVE",
                              "HOLD",
                              "CANCEL"
                            ],
                            "examples": [
                              "ACTIVE"
                            ],
                            "title": "ProductionStatus",
                            "type": "string"
                          },
                          "specificationId": {
                            "examples": [
                              "2WL5eYSWGzCHlGmzNxuqVusPxDg"
                            ],
                            "type": "string"
                          },
                          "status": {
                            "default": "PENDING",
                            "description": "The supplier status of an individual letter",
                            "enum": [
                              "PENDING",
                              "ACCEPTED",
                              "REJECTED",
                              "PRINTED",
                              "ENCLOSED",
                              "CANCELLED",
                              "DISPATCHED",
                              "DELIVERED",
                              "FAILED",
                              "RETURNED",
                              "DESTROYED",
                              "FORWARDED"
                            ],
                            "examples": [
                              "PENDING"
                            ],
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "id": {
                        "examples": [
                          "2WL5eYSWGzCHlGmzNxuqVusPxDg"
                        ],
                        "type": "string"
                      },
                      "type": {
                        "const": "Letter",
                        "type": "string"
                      }
                    },
                    "type": "object"
                  }
                },
                "type": "object"
              }
            }
          },
          "required": true
        },
        "responses": {
          "200": {
            "content": {
              "application/vnd.api+json": {
                "examples": {
                  "patch_letter-response": {
                    "value": {
                      "data": {
                        "attributes": {
                          "reasonCode": 100,
                          "reasonText": "failed validation",
                          "requestedProductionStatus": "ACTIVE",
                          "specificationId": "2WL5eYSWGzCHlGmzNxuqVusPxDg",
                          "status": "REJECTED"
                        },
                        "id": "2WL5eYSWGzCHlGmzNxuqVusPxDg",
                        "type": "Letter"
                      }
                    }
                  }
                },
                "schema": {
                  "properties": {
                    "data": {
                      "properties": {
                        "attributes": {
                          "properties": {
                            "reasonCode": {
                              "description": "Reason code for the given status",
                              "examples": [
                                100
                              ],
                              "type": "number"
                            },
                            "reasonText": {
                              "description": "Reason text for the given status",
                              "examples": [
                                "failed validation"
                              ],
                              "type": "string"
                            },
                            "requestedProductionStatus": {
                              "description": "A requested status for the production of a letter",
                              "enum": [
                                "ACTIVE",
                                "HOLD",
                                "CANCEL"
                              ],
                              "examples": [
                                "ACTIVE"
                              ],
                              "title": "ProductionStatus",
                              "type": "string"
                            },
                            "specificationId": {
                              "examples": [
                                "2WL5eYSWGzCHlGmzNxuqVusPxDg"
                              ],
                              "type": "string"
                            },
                            "status": {
                              "default": "PENDING",
                              "description": "The supplier status of an individual letter",
                              "enum": [
                                "PENDING",
                                "ACCEPTED",
                                "REJECTED",
                                "PRINTED",
                                "ENCLOSED",
                                "CANCELLED",
                                "DISPATCHED",
                                "DELIVERED",
                                "FAILED",
                                "RETURNED",
                                "DESTROYED",
                                "FORWARDED"
                              ],
                              "examples": [
                                "PENDING"
                              ],
                              "type": "string"
                            }
                          },
                          "required": [
                            "specificationId",
                            "status"
                          ],
                          "type": "object"
                        },
                        "id": {
                          "examples": [
                            "2WL5eYSWGzCHlGmzNxuqVusPxDg"
                          ],
                          "type": "string"
                        },
                        "type": {
                          "const": "Letter",
                          "type": "string"
                        }
                      },
                      "type": "object"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Letter resource updated successfully"
          },
          "400": {
            "content": {
              "application/vnd.api+json": {
                "examples": {
                  "error-bad-request": {
                    "value": {
                      "errors": [
                        {
                          "code": "NOTIFY_INVALID_REQUEST",
                          "detail": "Invalid request, please refer to the API specifications",
                          "id": "rrt-1931948104716186917-c-geu2-10664-3111479-3.0",
                          "links": {
                            "about": "https://digital.nhs.uk/developer/api-catalogue/nhs-notify-supplier"
                          },
                          "status": "400",
                          "title": "Invalid request"
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "properties": {
                    "errors": {
                      "items": {
                        "properties": {
                          "code": {
                            "enum": [
                              "NOTIFY_INTERNAL_SERVER_ERROR",
                              "NOTIFY_INVALID_REQUEST",
                              "NOTIFY_LETTER_NOT_FOUND"
                            ],
                            "type": "string"
                          },
                          "detail": {
                            "type": "string"
                          },
                          "id": {
                            "type": "string"
                          },
                          "links": {
                            "properties": {
                              "about": {
                                "format": "uri",
                                "type": "string"
                              }
                            },
                            "type": "object"
                          },
                          "status": {
                            "type": "string"
                          },
                          "title": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Bad request, invalid input data"
          },
          "404": {
            "content": {
              "application/vnd.api+json": {
                "examples": {
                  "error-not-found": {
                    "value": {
                      "errors": [
                        {
                          "code": "NOTIFY_RESOURCE_NOT_FOUND",
                          "detail": "No resource found with that ID",
                          "id": "rrt-1931948104716186917-c-geu2-10664-3111479-3.0",
                          "links": {
                            "about": "https://digital.nhs.uk/developer/api-catalogue/nhs-notify-supplier"
                          },
                          "status": "404",
                          "title": "Resource not found"
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "properties": {
                    "errors": {
                      "items": {
                        "properties": {
                          "code": {
                            "enum": [
                              "NOTIFY_INTERNAL_SERVER_ERROR",
                              "NOTIFY_INVALID_REQUEST",
                              "NOTIFY_LETTER_NOT_FOUND"
                            ],
                            "type": "string"
                          },
                          "detail": {
                            "type": "string"
                          },
                          "id": {
                            "type": "string"
                          },
                          "links": {
                            "properties": {
                              "about": {
                                "format": "uri",
                                "type": "string"
                              }
                            },
                            "type": "object"
                          },
                          "status": {
                            "type": "string"
                          },
                          "title": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Resource not found"
          },
          "429": {
            "content": {
              "application/vnd.api+json": {
                "examples": {
                  "error-too-many-requests": {
                    "value": {
                      "errors": [
                        {
                          "code": "NOTIFY_QUOTA",
                          "detail": "You have made too many requests. Please try again later.",
                          "id": "rrt-1931948104716186917-c-geu2-10664-3111479-3.0",
                          "links": {
                            "about": "https://digital.nhs.uk/developer/api-catalogue/nhs-notify-supplier"
                          },
                          "status": "429",
                          "title": "Too many requests"
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "properties": {
                    "errors": {
                      "items": {
                        "properties": {
                          "code": {
                            "enum": [
                              "NOTIFY_INTERNAL_SERVER_ERROR",
                              "NOTIFY_INVALID_REQUEST",
                              "NOTIFY_LETTER_NOT_FOUND"
                            ],
                            "type": "string"
                          },
                          "detail": {
                            "type": "string"
                          },
                          "id": {
                            "type": "string"
                          },
                          "links": {
                            "properties": {
                              "about": {
                                "format": "uri",
                                "type": "string"
                              }
                            },
                            "type": "object"
                          },
                          "status": {
                            "type": "string"
                          },
                          "title": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Too many requests"
          },
          "500": {
            "content": {
              "application/vnd.api+json": {
                "examples": {
                  "error-server-error": {
                    "value": {
                      "errors": [
                        {
                          "code": "NOTIFY_INTERNAL_SERVER_ERROR",
                          "detail": "An unexpected error occurred, please contact support",
                          "id": "rrt-1931948104716186917-c-geu2-10664-3111479-3.0",
                          "links": {
                            "about": "https://digital.nhs.uk/developer/api-catalogue/nhs-notify-supplier"
                          },
                          "status": "500",
                          "title": "Internal server error"
                        }
                      ]
                    }
                  }
                },
                "schema": {
                  "properties": {
                    "errors": {
                      "items": {
                        "properties": {
                          "code": {
                            "enum": [
                              "NOTIFY_INTERNAL_SERVER_ERROR",
                              "NOTIFY_INVALID_REQUEST",
                              "NOTIFY_LETTER_NOT_FOUND"
                            ],
                            "type": "string"
                          },
                          "detail": {
                            "type": "string"
                          },
                          "id": {
                            "type": "string"
                          },
                          "links": {
                            "properties": {
                              "about": {
                                "format": "uri",
                                "type": "string"
                              }
                            },
                            "type": "object"
                          },
                          "status": {
                            "type": "string"
                          },
                          "title": {
                            "type": "string"
                          }
                        },
                        "type": "object"
                      },
                      "type": "array"
                    }
                  },
                  "type": "object"
                }
              }
            },
            "description": "Server error"
          }
        },
        "security": [
          {
            "LambdaAuthorizer": []
          }
        ],
        "summary": "Update the status of a letter",
        "tags": [
          "letter"
        ],
        "x-amazon-apigateway-integration": {
          "contentHandling": "CONVERT_TO_TEXT",
          "credentials": "${APIG_EXECUTION_ROLE_ARN}",
          "httpMethod": "POST",
          "passthroughBehavior": "WHEN_NO_TEMPLATES",
          "responses": {
            ".*": {
              "statusCode": "200"
            }
          },
          "timeoutInMillis": 29000,
          "type": "AWS_PROXY",
          "uri": "arn:aws:apigateway:${AWS_REGION}:lambda:path/2015-03-31/functions/${PATCH_LETTERS_LAMBDA_ARN}/invocations"
        }
      }
    }
  }
}
